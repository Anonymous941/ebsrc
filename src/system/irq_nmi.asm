
IRQ: ;$C0814F
	PHP
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8
	PHA
	PHX
	PHY
	PHD
	PEA $0000
	PLD
	PHB
	PEA $0000
	PLB
	PLB
	SEP #PROC_FLAGS::ACCUM8
	LDA TIMEUP
	BMI IRQ_ENABLED
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8
	PLB
	PLD
	PLY
	PLX
	PLA
	PLP
	RTI
NMI:
	PHP
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8
	PHA
	PHX
	PHY
	PHD
	PEA $0000
	PLD
	PHB
	PEA $0000
	PLB
	PLB
	SEP #PROC_FLAGS::ACCUM8
IRQ_ENABLED:
	LDA RDNMI
	STZ HDMAEN
	LDA #$0080
	STA INIDISP
	INC $2B
	INC $02
	REP #PROC_FLAGS::ACCUM8
	SEP #PROC_FLAGS::INDEX8
	LDX $2C
	BEQ @UNKNOWN2
	LDY #$0000
	STZ OAMADDL
	STY DMAP0
	STY A1B0
	LDY #$0004
	STY BBAD0
	LDA #$0500
	LDX $2C
	DEX
	BEQ @UNKNOWN1
	LDA #$0800
@UNKNOWN1:
	STA A1T0L
	LDA #$0220
	STA DAS0L
	LDY #$0001
	STY MDMAEN
	CLC
	ADC $99
	STA $99
@UNKNOWN2:
	LDX a:.LOWORD(UNKNOWN_7E0030)
	BEQ @UNKNOWN3
	LDA .LOWORD(UNKNOWN_C08F98) - 4,X
	STA A1T0L
	LDY .LOWORD(UNKNOWN_C08F98) - 2,X
	STY CGADD
	LDA #$2200
	STA DMAP0
	LDY #$0000
	STY A1B0
	STY a:.LOWORD(UNKNOWN_7E0030)
	LDA .LOWORD(UNKNOWN_C08F98) - 6,X
	STA DAS0L
	LDY #$0001
	STY MDMAEN
	CLC
	ADC $99
	STA $99
@UNKNOWN3:
	SEP #PROC_FLAGS::ACCUM8
	LDA $28
	BEQ @UNKNOWN7
	DEC $2A
	BPL @UNKNOWN7
	LDA $29
	STA $2A
	LDA $0D
	AND #$000F
	CLC
	ADC $28
	BPL @UNKNOWN4
	STZ a:.LOWORD(HDMAEN_MIRROR)
	LDA #$0080
	BRA @UNKNOWN5
@UNKNOWN4:
	CMP #$0010
	BCC @UNKNOWN6
	LDA #$000F
@UNKNOWN5:
	STZ $28
@UNKNOWN6:
	STA $0D
@UNKNOWN7:
	REP #PROC_FLAGS::INDEX8
	LDA $0D
	STA INIDISP
	LDA $10
	STA MOSAIC
	LDY $15
	STY BG12NBA
	LDY $17
	LDY #$00FF
	STY WH2
	REP #PROC_FLAGS::ACCUM8
	SEP #PROC_FLAGS::INDEX8
	LDX $01
	BRA @UNKNOWN9
@UNKNOWN8:
	LDY $0400,X
	LDA .LOWORD(DMA_TABLE),Y
	STA DMAP0
	LDA .LOWORD(DMA_TABLE) + 2,Y
	STA VMAIN
	LDA .LOWORD(UNKNOWN_7F0400) + 1,X
	STA DAS0L
	LDA .LOWORD(UNKNOWN_7F0400) + 3,X
	STA A1T0L
	LDY .LOWORD(UNKNOWN_7F0400) + 5,X
	STY A1B0
	LDA .LOWORD(UNKNOWN_7F0400) + 6,X
	STA VMADDL
	TXA
	CLC
	ADC #$0008
	TAX
	LDY #$0001
	STY MDMAEN
@UNKNOWN9:
	CPX $00
	BNE @UNKNOWN8
	STX $01
	SEP #PROC_FLAGS::ACCUM8
	LDA $2C
	BNE @UNKNOWN10
	JMP a:.LOWORD(@UNKNOWN12)
@UNKNOWN10:
	DEC
	BNE @UNKNOWN11
	LDA $41
	STA BG1HOFS
	LDA $42
	STA BG1HOFS
	LDA $45
	STA BG1VOFS
	LDA $46
	STA BG1VOFS
	LDA $49
	STA BG2HOFS
	LDA $4A
	STA BG2HOFS
	LDA $4D
	STA BG2VOFS
	LDA $4E
	STA BG2VOFS
	LDA $51
	STA BG3HOFS
	LDA $52
	STA BG3HOFS
	LDA $55
	STA BG3VOFS
	LDA $56
	STA BG3VOFS
	LDA $59
	STA BG4HOFS
	LDA $5A
	STA BG4HOFS
	LDA $5D
	STA BG4VOFS
	LDA $5E
	STA BG4VOFS
	BRA @UNKNOWN12
@UNKNOWN11:
	LDA $43
	STA BG1HOFS
	LDA $44
	STA BG1HOFS
	LDA $47
	STA BG1VOFS
	LDA $48
	STA BG1VOFS
	LDA $4B
	STA BG2HOFS
	LDA $4C
	STA BG2HOFS
	LDA $4F
	STA BG2VOFS
	LDA $50
	STA BG2VOFS
	LDA $53
	STA BG3HOFS
	LDA $54
	STA BG3HOFS
	LDA $57
	STA BG3VOFS
	LDA $58
	STA BG3VOFS
	LDA $5B
	STA BG4HOFS
	LDA $5C
	STA BG4HOFS
	LDA $5F
	STA BG4VOFS
	LDA $60
	STA BG4VOFS
	REP #PROC_FLAGS::ACCUM8
	LDA a:.LOWORD(BG1_X_POS)
	STA a:.LOWORD(UNKNOWN_7E0061)
	LDA a:.LOWORD(BG1_Y_POS)
	STA a:.LOWORD(UNKNOWN_7E0063)
@UNKNOWN12:
	LDY #$0000
	STY $2C
	LDX $0D
	BMI @UNKNOWN13
	LDX $1A
	STX TM
	LDX $1B
	STX TD
	LDX $1F
	STX HDMAEN
@UNKNOWN13:
	JSR a:.LOWORD(UNKNOWN_C08501)
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8
	STZ $99
	LDA a:.LOWORD(UNKNOWN_7E0022)
	BNE @UNKNOWN14
	INC a:.LOWORD(UNKNOWN_7E0022)
	PHB
	PEA $7E7E
	PLB
	PLB
	PHD
	PEA $0200
	PLD
	JSR a:.LOWORD(UNKNOWN_C08518)
	PLD
	PLB
	STZ a:.LOWORD(UNKNOWN_7E0022)
@UNKNOWN14:
	LDA #$2000
	CMP $A3
	BNE @UNKNOWN15
	LDA #$2200
@UNKNOWN15:
	STA $A3
	STA $A1
	LDA #$0000
	STA DMA_TRANSFER_FLAG
	STZ $AB
	INC $A7
	BNE @RETURN
	INC $A9
@RETURN:
	PLB
	PLD
	PLY
	PLX
	PLA
	PLP
	RTI
